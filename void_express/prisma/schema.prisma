// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  User
  Admin
}

enum User_status {
  Not_banned
  Ban
}

enum Friend_status {
  None
  Expectation
  Accepted
  Rejected
}

enum Post_status {
  Expectation
  Published
  Rejected
}



model User {
  id         Int      @id @default(autoincrement())
  role       UserRole @default(User)
  name       String
  last_name  String
  login      String   @unique
  email      String   @unique
  password   String
  avatar     String?
  created_at DateTime @default(now())
  status User_status @default(Not_banned)

  id_category Category[] @relation("UserCategories")

  posts Post[]

  friendships1 Friends[] @relation("FriendsUser1")
  friendships2 Friends[] @relation("FriendsUser2")

  sent_messages Message[] @relation("MessageUser")
}

model Category {
  id   Int    @id @default(autoincrement())
  name String
  created_at DateTime @default(now())

  users_category User[] @relation("UserCategories")
  posts          Post[]
}

model Post {
  id         Int      @id @default(autoincrement())
  title      String
  text       String
  created_at DateTime @default(now())
  status Post_status @default(Expectation)

  category_id        Int
  post_category_ship Category @relation(fields: [category_id], references: [id])

  user_id        Int
  user_post_ship User @relation(fields: [user_id], references: [id])

  images Post_image[]
}

model Post_image {
  id          Int    @id @default(autoincrement())
  image_url   String
  image_order Int

  post_id         Int?
  post_image_ship Post? @relation(fields: [post_id], references: [id])
}

model Friends {
  id       Int           @id @default(autoincrement())
  user1_id Int
  user2_id Int
  status   Friend_status @default(None)

  user1 User @relation("FriendsUser1", fields: [user1_id], references: [id])
  user2 User @relation("FriendsUser2", fields: [user2_id], references: [id])

  chatUser1 Chat[] @relation("ChatUser1")
  chatUser2 Chat[] @relation("ChatUser2")
}

model Chat {
  id Int @id @default(autoincrement())

  user1_id Int
  user2_id Int
  created_at DateTime @default(now())

  user1 Friends @relation("ChatUser1", fields: [user1_id], references: [id])
  user2 Friends @relation("ChatUser2", fields: [user2_id], references: [id])

  messages Message[] @relation("MessageChat")
}

model Message {
  id           Int      @id @default(autoincrement())
  message_text String
  is_read      Boolean  @default(false)
  created_at   DateTime @default(now())

  chat_id Int
  chat    Chat @relation("MessageChat", fields: [chat_id], references: [id])

  sender_id   Int
  MessageUser User @relation("MessageUser", fields: [sender_id], references: [id])
}
